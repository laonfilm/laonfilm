---
// src/components/TypewriterTagline.astro
---

<div class="typewriter-container">
  <div class="typewriter-text" id="typewriter-text"></div>
  <span class="cursor" id="cursor">|</span>
</div>

<style>
.typewriter-container {
  text-align: center;
  font-family: "Special Elite", "Courier New", Courier, monospace;
  font-size: 1.1rem;
  color: var(--text);
  opacity: 0.85;
  letter-spacing: 0.5px;
  margin: 1.5rem auto 2.5rem;
  max-width: var(--container);
  padding: 0 2rem;
  min-height: 1.6rem; /* Reserve space to prevent layout shift */
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
}

.typewriter-text {
  display: inline;
}

.cursor {
  display: inline-block;
  animation: blink 1s infinite;
  margin-left: 1px;
  font-weight: normal;
}

@keyframes blink {
  0%, 50% { opacity: 1; }
  51%, 100% { opacity: 0; }
}

/* Hide cursor after animation completes */
.cursor.hidden {
  display: none;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .typewriter-container {
    font-size: 1rem;
    margin: 1rem auto 2rem;
    padding: 0 1.5rem;
  }
}

@media (max-width: 480px) {
  .typewriter-container {
    font-size: 0.95rem;
    margin: 0.75rem auto 1.5rem;
    padding: 0 1rem;
  }
}
</style>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const textElement = document.getElementById("typewriter-text");
  const cursorElement = document.getElementById("cursor");
  const targetText = "A love letter to Los Angeles, written on instant film.";
  const typeSpeed = 120; // milliseconds per character
  const pauseAfterComplete = 1500; // pause before hiding cursor
  
  // Check if animation has been seen before
  const hasSeenAnimation = localStorage.getItem("laonfilm-typewriter-seen");
  
  if (hasSeenAnimation === "true") {
    // Show text immediately without animation
    if (textElement) {
      textElement.textContent = targetText;
    }
    if (cursorElement) {
      cursorElement.classList.add("hidden");
    }
    return;
  }
  
  // Run typewriter animation
  let currentIndex = 0;
  
  function typeChar() {
    if (currentIndex < targetText.length && textElement) {
      textElement.textContent += targetText.charAt(currentIndex);
      currentIndex++;
      setTimeout(typeChar, typeSpeed);
    } else {
      // Animation complete
      setTimeout(() => {
        if (cursorElement) {
          cursorElement.classList.add("hidden");
        }
        // Mark as seen so it won't animate again
        try {
          localStorage.setItem("laonfilm-typewriter-seen", "true");
        } catch (e) {
          // Handle case where localStorage isn't available
          console.log("localStorage not available");
        }
      }, pauseAfterComplete);
    }
  }
  
  // Start the animation after a short delay
  setTimeout(typeChar, 500);
});
</script>
